<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Processing Your Purchase...</title>
  <meta name="robots" content="noindex,nofollow" />

  <!-- Facebook Pixel -->
  <script>
    !function(f,b,e,v,n,t,s){
      if(f.fbq)return;n=f.fbq=function(){
        n.callMethod? n.callMethod.apply(n,arguments):n.queue.push(arguments)
      };
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)
    }(window, document,'script','https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '127978927946856');
    fbq('track', 'PageView');
  </script>

  <!-- TikTok Pixel -->
  <script>
    !function (w, d, t) {
      w.TiktokAnalyticsObject = t;
      var ttq = w[t] = w[t] || [];
      ttq.methods = ["page","track"];
      ttq.setAndDefer = function (t, e) {
        t[e] = function () {
          t.push([e].concat(Array.prototype.slice.call(arguments, 0)))
        }
      };
      for (var i = 0; i < ttq.methods.length; i++) {
        ttq.setAndDefer(ttq, ttq.methods[i]);
      }
      ttq.load = function (e, n) {
        var i = "https://analytics.tiktok.com/i18n/pixel/events.js";
        ttq._i = ttq._i || {};
        ttq._i[e] = [];
        ttq._t = ttq._t || {};
        ttq._t[e] = +new Date;
        ttq._o = ttq._o || {};
        ttq._o[e] = n || {};
        var o = document.createElement("script");
        o.type = "text/javascript";
        o.async = true;
        o.src = i + "?sdkid=" + e + "&lib=" + t;
        var a = document.getElementsByTagName("script")[0];
        a.parentNode.insertBefore(o, a);
      };
      ttq.load('D0EVS2JC77U9C23772EG');
      ttq.page();
    }(window, document, 'ttq');
  </script>

  <script>
    // ---- กำหนดค่า transaction (ถ้ามี)
    const orderValue = 399; // สมมติเป็น 399 บาท
    const currency = 'THB';

    // ----- เก็บ Event "Purchase" ของ Facebook Pixel -----
    function firePurchasePixel() {
      fbq('track', 'Purchase', {
        value: orderValue,
        currency: currency
      });
    }
    // ----- เก็บ Event "CompletePayment" ของ TikTok Pixel -----
    function firePurchaseTikTok() {
      ttq.track('CompletePayment', {
        value: orderValue,
        currency: currency
      });
    }

    // ยิง Event ก่อน Redirect จริง
    setTimeout(() => {
      firePurchasePixel();
      firePurchaseTikTok();
    }, 200); // รอ 0.2 วิ ให้พิกเซลโหลด

    // Redirect หลังยิง Event ประมาณ 1.5-2 วิ
    setTimeout(() => {
      window.location.href = 'https://singingfiles.com/show.php?l=0&u=1287837&id=69274&tracking_id=fb';
    }, 1700);
  </script>

  <style>
    body {
      margin: 0;
      background: #f6f9fc;
      font-family: Arial, sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 20px;
      color: #333;
    }
    .loader {
      border: 4px solid #eee;
      border-top: 4px solid #007bff;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    h1 { font-size: 22px; margin-bottom: 10px; }
    p { font-size: 16px; color: #666; }
    a { color: #007bff; font-weight: bold; text-decoration: none; }
  </style>
</head>
<body>
  <div class="loader"></div>
  <h1>Processing your purchase...</h1>
  <p>
    Please wait.<br />
    If not redirected, <a href="https://singingfiles.com/show.php?l=0&u=1287837&id=69274&tracking_id=fb">click here</a>.
  </p>
</body>
</html>
